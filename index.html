<!DOCTYPE html>
const table=document.createElement('table');
table.innerHTML = `<thead>
<th>Ações</th><th>Data</th><th class='col-left'>Descrição</th><th>Banco</th>
<th>Cedente</th><th>Cessionário</th><th>Compromissada</th><th>Retorno</th>
<th>Ganho</th></thead><tbody></tbody>`;


const tbody=table.querySelector('tbody');


operacoes.forEach((op,i)=>{
const c=parseNumber(op.compromissada);
const r=parseNumber(op.retorno);
const g=r-c;
totalC+=c; totalR+=r; totalG+=g;


if(showOps){
const row=tbody.insertRow();
row.insertCell().innerHTML = `<button class='btn small secondary' onclick='deleteEntry(${i})'>Excluir</button>`;
row.insertCell().textContent = formatDataBR(op.data);
row.insertCell().className='col-left';
row.insertCell().textContent = op.descricao;
row.insertCell().textContent = op.banco;
row.insertCell().textContent = op.cedente;
row.insertCell().textContent = op.cessionario;
row.insertCell().textContent = formatBRL(c);
row.insertCell().textContent = formatBRL(r);
row.insertCell().innerHTML = `<span class='${g>=0?'ganho':'perda'}'>${formatBRL(g)}</span>`;
}
});


container.appendChild(table);
document.querySelector('#totalCompromissadaDisplay p').textContent=formatBRL(totalC);
document.querySelector('#totalRetornoDisplay p').textContent=formatBRL(totalR);
document.querySelector('#totalCdiDisplay p').textContent=formatBRL(totalG);
}


/* --- Importar Excel --- */
document.getElementById('loadExcelBtn').onclick=()=>{
const files = document.getElementById('excelFile').files;
if(!files.length){ log('Nenhum arquivo.'); return; }


let newOps=[];


[...files].forEach(file=>{
const reader=new FileReader();
reader.onload=e=>{
const wb=XLSX.read(new Uint8Array(e.target.result),{type:'array'});
wb.SheetNames.forEach(name=>{
const sheet=XLSX.utils.sheet_to_json(wb.Sheets[name],{header:1});
sheet.slice(1).forEach(row=>{
if(!row.length) return;
newOps.push({
data: normalizeDate(row[0]),
descricao: String(row[1]||''),
banco: String(row[2]||''),
cedente: String(row[3]||''),
cessionario: String(row[4]||''),
compromissada: String(row[5]||''),
retorno: String(row[6]||''),
});
});
});
operacoes = operacoes.concat(newOps);
calculateAndRender();
saveState();
log("Importado com sucesso.");
};
reader.readAsArrayBuffer(file);
});
};


function deleteEntry(i){ operacoes.splice(i,1); calculateAndRender(); saveState(); }
</script>


</body>
</html>
